module.exports = ({
  componentName,
  moduleName,
  moduleVersion,
  patch,
  dependenciesVersions,
}) => {
  const depImports = patch.customDeps
    ? patch.customDeps.map(
        dep =>
          dependenciesVersions[dep]
            ? `import ${dep} ${dependenciesVersions[dep]}\n`
            : ''
      )
    : [];

  const qmlContent = `
${depImports.join('')}
import ${moduleName} ${moduleVersion}
${componentName} {
  ${patch.customQml || ''}
}
`;
  const NATIVE_COMPONENT_REGISTRY_NAME = `${moduleName}.${componentName}_${
    moduleVersion
  }`;

  const defaultProp = JSON.stringify(patch.defaultProp);

  return `/* this file is automatically generated */
import { registerNativeComponentClass } from 'react-qml-renderer';
import { createElement, Component } from 'react';

const qmlContent = ${JSON.stringify(qmlContent)};
const NATIVE_COMPONENT_REGISTRY_NAME = '${NATIVE_COMPONENT_REGISTRY_NAME}'

registerNativeComponentClass(
  NATIVE_COMPONENT_REGISTRY_NAME,
  qmlContent,
  ${defaultProp}
);

export default class ${componentName} extends Component {
  setRef = qmlObject => (this.qmlObject = qmlObject);
  render() {
    var nextProps = {};

    for (var key in this.props) {
      nextProps[key] = this.props[key];
    }

    nextProps.ref = this.setRef;

    return createElement(NATIVE_COMPONENT_REGISTRY_NAME, nextProps);
  }
}
`;
};
